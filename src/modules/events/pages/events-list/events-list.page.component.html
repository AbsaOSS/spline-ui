<!--
  ~ Copyright (c) 2020 ABSA Group Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<div class="container">
    <h1 class="page-title">
        Execution Events
    </h1>

    <div style="min-height: 300px">

        <ng-container *ngIf="(loadingProcessing$ | async) as loadingProcessing">
            <!-- LOADER -->
            <spline-loader *ngIf="loadingProcessing.processing"></spline-loader>
            <!-- ./LOADER -->

            <!-- ERROR -->
            <spline-content-error *ngIf="loadingProcessing.processingError"></spline-content-error>
            <!-- ./ERROR -->
        </ng-container>

        <mat-table [dataSource]="(data$ | async)?.items" matSort>

            <!-- executionPlanId -->
            <ng-container [matColumnDef]="'executionPlanId'">
                <mat-header-cell *matHeaderCellDef>
                    Execution Plan
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    <a href="/">{{rowData.executionPlanId}}</a>
                </mat-cell>
            </ng-container>
            <!-- ./executionPlanId -->

            <!-- applicationName -->
            <ng-container [matColumnDef]="'applicationName'">
                <mat-header-cell *matHeaderCellDef>
                    Application Name
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    <div>
                        <a [routerLink]="['../overview', rowData.executionEventId]">
                            {{rowData.applicationName}}
                        </a>
                    </div>
                </mat-cell>
            </ng-container>
            <!-- ./applicationName -->

            <!-- applicationId -->
            <ng-container [matColumnDef]="'applicationId'">
                <mat-header-cell *matHeaderCellDef>
                    Application Name
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    {{rowData.applicationId}}
                </mat-cell>
            </ng-container>
            <!-- ./applicationId -->

            <!-- timestamp -->
            <ng-container [matColumnDef]="'timestamp'">
                <mat-header-cell *matHeaderCellDef
                                 mat-sort-header>
                    Executed At
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    <div class="max-width-100 text-center">
                        {{rowData.timestamp | date : 'yyyy-MM-dd'}}
                        <div class="minor-text">
                            {{rowData.timestamp | date : 'HH:mm:ss'}}
                        </div>
                    </div>
                </mat-cell>
            </ng-container>
            <!-- ./timestamp -->

            <!-- dataSource -->
            <ng-container [matColumnDef]="'dataSource'">
                <mat-header-cell *matHeaderCellDef>
                    Data Source
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    <div class="max-width-100">
                        <a href="/">{{rowData.dataSourceUri.split('/').slice(-1)[0]}}</a>
                        <div class="minor-text">
                            {{rowData.dataSourceUri}}
                        </div>
                    </div>
                </mat-cell>
            </ng-container>
            <!-- ./dataSource -->

            <!-- dataSourceType -->
            <ng-container [matColumnDef]="'dataSourceType'">
                <mat-header-cell *matHeaderCellDef>
                    Data Source Type
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    {{rowData.dataSourceType}}
                </mat-cell>
            </ng-container>
            <!-- ./dataSourceType -->

            <!-- append -->
            <ng-container [matColumnDef]="'append'">
                <mat-header-cell *matHeaderCellDef>
                    Write Mode
                </mat-header-cell>
                <mat-cell *matCellDef="let rowData">
                    <div [class.write-mode--pink]="!rowData.append" class="write-mode">
                        {{rowData.append && 'Append' || 'Override'}}
                    </div>
                </mat-cell>
            </ng-container>
            <!-- ./dataSourceType -->

            <mat-header-row *matHeaderRowDef="visibleColumns"></mat-header-row>

            <mat-row *matRowDef="let row; columns: visibleColumns;"></mat-row>

        </mat-table>
    </div>
</div>
